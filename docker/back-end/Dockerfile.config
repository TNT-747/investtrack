# backend/config-server/Dockerfile
# Multi-stage build: build with maven, run with slim JRE

### Builder stage
FROM maven:3.9.4-eclipse-temurin-17 AS builder
WORKDIR /build
COPY pom.xml .
# Copy only the pom first to leverage Docker cache for dependency install
COPY src ./src
RUN mvn -B -DskipTests package

### Run stage
FROM eclipse-temurin:17-jre-jammy
WORKDIR /app
# copy the produced jar (assumes standard Spring Boot packaging)
COPY --from=builder /build/target/*-SNAPSHOT.jar app.jar
# If your artifact name is different, change the glob above

EXPOSE 8888
ENV JAVA_OPTS=""

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar /app/app.jar"]

# Optional healthcheck (requires actuator enabled on /actuator/health)
# HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
#   CMD curl -fsS http://localhost:8888/actuator/health || exit 1
